import{o as I,k,p as L,q,j as f,f as V,Y,z as b,i as H,J as T,N as F,Q as G,M as B,D as x,u as d,n as w,t as R,Z as J,_ as Q,$ as U,h as W,w as j,F as X,l as Z,B as K,C as z,x as ee,a0 as te,g as D}from"./vendor.7d2fdebc.js";import{_ as M,u as ne,C as oe,a as se,b as re}from"./index.87b643b9.js";const ie={},ae=e=>(L("data-v-7a880f6e"),e=e(),q(),e),le={class:"container"},ce=ae(()=>f("div",{class:"spinner"},null,-1)),ue=[ce];function de(e,t){return I(),k("div",le,ue)}var _e=M(ie,[["render",de],["__scopeId","data-v-7a880f6e"]]);const ve=e=>({loading(){e.value="loading"},loaded(){e.value="loaded"},complete(){e.value="complete"},error(){e.value="error"}});function fe(e,t){return()=>{t.loading(),e("infinite",t)}}function me(e,t){const n=e.getBoundingClientRect();return Math.abs(n.top)*2<=t.clientHeight||!t.clientHeight}const ge=(e,{state:t,distance:n,emitInfiniteEvent:c,top:o})=>()=>{if(!t)return;const{scrollTop:i,scrollHeight:u,clientHeight:r}=e,a=t.value==="loaded"||!t.value;o&&Math.ceil(i)-(n||0)<=0&&a&&c(),!o&&Math.ceil(i)+r>=u-(n||0)&&a&&c()},P=(e,t)=>{if(e.target&&!document.querySelector(e.target))throw new Error("Vue3 infinite loading: target prop should be a valid css selector");const n=e.target?document.querySelector(e.target):document.documentElement,c=e.target?document.querySelector(e.target):window,o=document.getElementById(t);if(!n||!c)throw new Error("Vue3 infinite loading: target prop should be a valid css selector");if(!o)throw new Error("Vue3 infinite loading: infinite-loading element not found");me(o,n)&&e.firstLoad&&e.emitInfiniteEvent();const i=ge(n,e);return c.addEventListener("scroll",i),()=>{c.removeEventListener("scroll",i)}};const pe=["id"],he={class:"state-error"},be=V({props:{top:{type:Boolean,default:!1},target:null,distance:{default:0},identifier:null,firstLoad:{type:Boolean,default:!0}},emits:["infinite"],setup(e,{emit:t}){const n=e,c=Y(),o=b(""),i=b(0),u=b(`v3-infinite-loading-${`${Math.random()}`.substring(2)}`),r=b(()=>{}),a=H(()=>({state:o,target:n.target,distance:n.distance,top:n.top,firstLoad:n.firstLoad,emitInfiniteEvent:fe(t,ve(o))}));return T(o,_=>{const m=n.target&&document.querySelector(n.target)||document.documentElement;_==="loaded"&&top&&(Promise.resolve().then(()=>{m.scrollTop=m.scrollHeight-i.value}),i.value=m.scrollHeight),_==="complete"&&r.value()}),T(()=>n.identifier,()=>{o.value="",r.value(),r.value=P(a.value,u.value)}),F(()=>{r.value=P(a.value,u.value);const _=n.target&&document.querySelector(n.target)||document.documentElement;i.value=_.scrollHeight}),G(()=>{r.value()}),(_,m)=>{const y=_e;return I(),k("div",{id:u.value,class:"v3-infinite-loader"},[o.value=="loading"?B(_.$slots,"spinner",{key:0},()=>[w(y)],!0):x("",!0),o.value=="complete"?B(_.$slots,"complete",{key:1},()=>{var p;return[f("span",null,R(((p=d(c))==null?void 0:p.complete)||"No more results!"),1)]},!0):x("",!0),o.value=="error"?B(_.$slots,"error",{key:2,retry:d(a).emitInfiniteEvent},()=>{var p;return[f("span",he,[f("span",null,R(((p=d(c))==null?void 0:p.error)||"Oops something went wrong!"),1),f("button",{class:"retry",onClick:m[0]||(m[0]=(...s)=>d(a).emitInfiniteEvent&&d(a).emitInfiniteEvent(...s))},"retry")])]},!0):x("",!0)],8,pe)}}});var Ie=M(be,[["__scopeId","data-v-671ba24c"]]),ye=J,A=1/0,Se=17976931348623157e292;function Ee(e){if(!e)return e===0?e:0;if(e=ye(e),e===A||e===-A){var t=e<0?-1:1;return t*Se}return e===e?e:0}var we=Ee,$e=we;function ke(e){var t=$e(e),n=t%1;return t===t?n?t-n:t:0}var xe=ke,Me=Q,Ce=U,Ne=xe,He=Math.ceil,Te=Math.max;function Be(e,t,n){(n?Ce(e,t,n):t===void 0)?t=1:t=Te(Ne(t),0);var c=e==null?0:e.length;if(!c||t<1)return[];for(var o=0,i=0,u=Array(He(c/t));o<c;)u[i++]=Me(e,o,o+=t);return u}var Le=Be;const O=e=>(L("data-v-54b1cc72"),e=e(),q(),e),qe={key:0,class:"message-list"},Ve={id:"message-list-content"},Fe=O(()=>f("div",{class:"no-messages"}," No more messages to show, this is the beginning of the channel. ",-1)),Re=ee(" Scroll to Latest Messages "),je=O(()=>f("span",null,null,-1)),De=V({setup(e){const t=ne(),n=W(),c=30,o=b(0),i=b(0),u=b([]),r=H(()=>{var s;return(s=t.channels)==null?void 0:s.find(l=>{var g;return l.id===((g=n.params)==null?void 0:g.channelId)})}),a=H(()=>{var s,l;return Le([...(l=(s=r.value)==null?void 0:s.rootMessages)!=null?l:[]].reverse(),c)}),_=s=>{setTimeout(()=>{if(!r.value||!a.value[o.value]){s.loaded();return}const l=[...a.value[o.value]];u.value.unshift(...l.reverse()),o.value++,o.value>=a.value.length?s.complete():s.loaded()},100)},m=s=>{setTimeout(()=>{if(i.value<=0){s.complete();return}if(!r.value||!a.value[i.value]){s.loaded();return}const l=[...a.value[i.value]];u.value.push(...l.reverse()),i.value++,i.value<=0?s.complete():s.loaded()},100)},y=(s=!1)=>{var $,S;let l=0;const g=`${n.query.threadRef}`;if(g.startsWith(($=r.value)==null?void 0:$.id)&&((S=a.value)==null?void 0:S.length)&&!s){const v=Number(g.split("-")[1]);a.value.forEach((h,E)=>{h.some(N=>N.id===v)&&(l=E)}),setTimeout(()=>{const h=document.querySelector(`#message-${v}`);h&&h.scrollIntoView()},100)}o.value=l+1,i.value=l-1;const C=a.value[l]?[...a.value[l]]:[];u.value=C.reverse(),s&&te(()=>{const v=document.querySelector("#message-list-content");v&&(v.scrollTop=v.scrollHeight)})},p=s=>s>0?u.value[s-1]:null;return T(r,()=>{y()}),F(()=>{y()}),(s,l)=>{var S,v,h;const g=Ie,C=re,$=se;return((S=d(r))==null?void 0:S.id)?(I(),k("div",qe,[w(oe,{title:`#${d(r).name}`,subtitle:d(r).topic,"show-menu-button":""},null,8,["title","subtitle"]),f("div",Ve,[w(g,{identifier:(v=d(r))==null?void 0:v.id,target:"#message-list-content",top:"","first-load":!1,onInfinite:_},{complete:j(()=>[Fe]),_:1},8,["identifier"]),(I(!0),k(X,null,Z(u.value,(E,N)=>(I(),D(C,{key:d(r).rootMessages.indexOf(E),message:E,"above-message":p(N),"channel-id":d(r).id},null,8,["message","above-message","channel-id"]))),128)),K(f("button",{class:"scroll-bottom-btn",onClick:l[0]||(l[0]=E=>y(!0))},[w($,{icon:"mdi:arrow-down-circle-outline"}),Re],512),[[z,i.value>0]]),w(g,{identifier:(h=d(r))==null?void 0:h.id,target:"#message-list-content","first-load":!1,onInfinite:m},{complete:j(()=>[je]),_:1},8,["identifier"])])])):x("",!0)}}});var Pe=M(De,[["__scopeId","data-v-54b1cc72"]]);const Ae={};function Oe(e,t){const n=Pe;return I(),D(n)}var Je=M(Ae,[["render",Oe]]);export{Je as default};
