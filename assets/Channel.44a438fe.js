import{o as I,l as $,q,v as R,k as m,g as V,ab as U,D as h,j as k,L as T,a2 as F,a4 as W,a1 as N,C as M,u as d,p as E,t as j,ac as X,ad as Y,ae as J,i as K,w as D,F as Q,n as Z,h as P,G as z,H as ee,y as te,aa as ne}from"./vendor.ce23a725.js";import{_ as x,u as oe,C as se,a as ae,c as re}from"./index.bc6b037d.js";const ie={},le=e=>(q("data-v-7a880f6e"),e=e(),R(),e),ce={class:"container"},ue=le(()=>m("div",{class:"spinner"},null,-1)),de=[ue];function ve(e,t){return I(),$("div",ce,de)}var _e=x(ie,[["render",ve],["__scopeId","data-v-7a880f6e"]]);const fe=e=>({loading(){e.value="loading"},loaded(){e.value="loaded"},complete(){e.value="complete"},error(){e.value="error"}});function ge(e,t){return()=>{t.loading(),e("infinite",t)}}function me(e,t){const n=e.getBoundingClientRect();return Math.abs(n.top)*2<=t.clientHeight||!t.clientHeight}const pe=(e,{state:t,distance:n,emitInfiniteEvent:c,top:a})=>()=>{if(!t)return;const{scrollTop:i,scrollHeight:u,clientHeight:r}=e,l=t.value==="loaded"||!t.value;a&&Math.ceil(i)-(n||0)<=0&&l&&c(),!a&&Math.ceil(i)+r>=u-(n||0)&&l&&c()},A=(e,t)=>{if(e.target&&!document.querySelector(e.target))throw new Error("Vue3 infinite loading: target prop should be a valid css selector");const n=e.target?document.querySelector(e.target):document.documentElement,c=e.target?document.querySelector(e.target):window,a=document.getElementById(t);if(!n||!c)throw new Error("Vue3 infinite loading: target prop should be a valid css selector");if(!a)throw new Error("Vue3 infinite loading: infinite-loading element not found");me(a,n)&&e.firstLoad&&e.emitInfiniteEvent();const i=pe(n,e);return c.addEventListener("scroll",i),()=>{c.removeEventListener("scroll",i)}};const he=["id"],Ie={class:"state-error"},be=V({props:{top:{type:Boolean,default:!1},target:null,distance:{default:0},identifier:null,firstLoad:{type:Boolean,default:!0}},emits:["infinite"],setup(e,{emit:t}){const n=e,c=U(),a=h(""),i=h(0),u=h(`v3-infinite-loading-${`${Math.random()}`.substring(2)}`),r=h(()=>{}),l=k(()=>({state:a,target:n.target,distance:n.distance,top:n.top,firstLoad:n.firstLoad,emitInfiniteEvent:ge(t,fe(a))}));return T(a,v=>{const p=n.target&&document.querySelector(n.target)||document.documentElement;v==="loaded"&&n.top&&(Promise.resolve().then(()=>{p.scrollTop=p.scrollHeight-i.value}),i.value=p.scrollHeight),v==="complete"&&r.value()}),T(()=>n.identifier,()=>{a.value="",r.value(),r.value=A(l.value,u.value)}),F(()=>{r.value=A(l.value,u.value);const v=n.target&&document.querySelector(n.target)||document.documentElement;i.value=v.scrollHeight}),W(()=>{r.value()}),(v,p)=>{const C=_e;return I(),$("div",{id:u.value,class:"v3-infinite-loader"},[a.value=="loading"?N(v.$slots,"spinner",{key:0},()=>[E(C)],!0):M("",!0),a.value=="complete"?N(v.$slots,"complete",{key:1},()=>{var g;return[m("span",null,j(((g=d(c))==null?void 0:g.complete)||"No more results!"),1)]},!0):M("",!0),a.value=="error"?N(v.$slots,"error",{key:2,retry:d(l).emitInfiniteEvent},()=>{var g;return[m("span",Ie,[m("span",null,j(((g=d(c))==null?void 0:g.error)||"Oops something went wrong!"),1),m("button",{class:"retry",onClick:p[0]||(p[0]=(...H)=>d(l).emitInfiniteEvent&&d(l).emitInfiniteEvent(...H))},"retry")])]},!0):M("",!0)],8,he)}}});var ye=x(be,[["__scopeId","data-v-2adb7a48"]]),Se=X,G=1/0,Ee=17976931348623157e292;function we(e){if(!e)return e===0?e:0;if(e=Se(e),e===G||e===-G){var t=e<0?-1:1;return t*Ee}return e===e?e:0}var $e=we,ke=$e;function Me(e){var t=ke(e),n=t%1;return t===t?n?t-n:t:0}var xe=Me,Ce=Y,He=J,Be=xe,Le=Math.ceil,Te=Math.max;function Ne(e,t,n){(n?He(e,t,n):t===void 0)?t=1:t=Te(Be(t),0);var c=e==null?0:e.length;if(!c||t<1)return[];for(var a=0,i=0,u=Array(Le(c/t));a<c;)u[i++]=Ce(e,a,a+=t);return u}var qe=Ne;const O=e=>(q("data-v-01b3aba2"),e=e(),R(),e),Re={key:0,class:"message-list"},Ve={id:"message-list-content"},Fe=O(()=>m("div",{class:"no-messages"}," No more messages to show, this is the beginning of the channel. ",-1)),je=te(" Scroll to Latest Messages "),De=O(()=>m("span",null,null,-1)),Pe=V({setup(e){const t=oe(),n=K(),c=30,a=h(0),i=h(0),u=h([]),r=k(()=>{var o;return(o=t.channels)==null?void 0:o.find(s=>{var f;return s.id===((f=n.params)==null?void 0:f.channelId)})}),l=k(()=>{var o,s;return qe([...(s=(o=r.value)==null?void 0:o.rootMessages)!=null?s:[]].reverse(),c)}),v=k(()=>{var f;const o=n.query.threadRef||"",s=t.messagesById[o];return s.threadId?(f=t.messagesById[`${r.value.id}-${s.threadId}`])==null?void 0:f.id:s.id}),p=o=>{setTimeout(()=>{if(!r.value||!l.value[a.value]){o.loaded();return}const s=[...l.value[a.value]];u.value.unshift(...s.reverse()),a.value++,a.value>=l.value.length?o.complete():o.loaded()},100)},C=o=>{setTimeout(()=>{if(i.value<=0){o.complete();return}if(!r.value||!l.value[i.value]){o.loaded();return}const s=[...l.value[i.value]];u.value.push(...s.reverse()),i.value--,i.value<=0?o.complete():o.loaded()},100)},g=(o=!1)=>{var b,y;let s=0;const f=`${n.query.threadRef}`;let w=!1;f.startsWith((b=r.value)==null?void 0:b.id)&&((y=l.value)==null?void 0:y.length)&&!o&&(l.value.forEach((_,S)=>{_.some(L=>L.id===v.value)&&(s=S)}),w=!0,setTimeout(()=>{const _=document.querySelector(`#message-${v.value}`);_&&_.scrollIntoView()},100)),a.value=s+1,i.value=s-1;const B=l.value[s]?[...l.value[s]]:[];u.value=B.reverse(),w||ne(()=>{const _=document.querySelector("#message-list-content");_&&(_.scrollTop=_.scrollHeight)})},H=o=>o>0?u.value[o-1]:null;return T(r,(o,s)=>{(o==null?void 0:o.id)!==(s==null?void 0:s.id)&&g()}),F(()=>{g()}),(o,s)=>{var b,y,_;const f=ye,w=ae,B=re;return((b=d(r))==null?void 0:b.id)?(I(),$("div",Re,[E(se,{title:`#${d(r).name}`,subtitle:d(r).topic,"show-menu-button":""},null,8,["title","subtitle"]),m("div",Ve,[E(f,{identifier:(y=d(r))==null?void 0:y.id,target:"#message-list-content",top:"","first-load":!1,onInfinite:p},{complete:D(()=>[Fe]),_:1},8,["identifier"]),(I(!0),$(Q,null,Z(u.value,(S,L)=>(I(),P(w,{key:d(r).rootMessages.indexOf(S),message:S,"above-message":H(L),"channel-id":d(r).id},null,8,["message","above-message","channel-id"]))),128)),z(m("button",{class:"scroll-bottom-btn",onClick:s[0]||(s[0]=S=>g(!0))},[E(B,{icon:"mdi:arrow-down-circle-outline"}),je],512),[[ee,i.value>0]]),E(f,{identifier:(_=d(r))==null?void 0:_.id,target:"#message-list-content","first-load":!1,onInfinite:C},{complete:D(()=>[De]),_:1},8,["identifier"])])])):M("",!0)}}});var Ae=x(Pe,[["__scopeId","data-v-01b3aba2"]]);const Ge={};function Oe(e,t){const n=Ae;return I(),P(n)}var Xe=x(Ge,[["render",Oe]]);export{Xe as default};
