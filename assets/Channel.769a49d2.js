import{_ as C,u as T,C as j,a as R}from"./index.06121855.js";import{Y as V,_ as A,Z as D,z as S,$ as O,N as W,J as $,Q as Y,o as p,k as I,M as E,D as y,n as k,j as _,t as M,u as m,p as N,q as x,f as G,h as J,i as H,w as P,F as Q,l as U,g as B}from"./vendor.a792f018.js";var X=V,L=1/0,Z=17976931348623157e292;function K(e){if(!e)return e===0?e:0;if(e=X(e),e===L||e===-L){var t=e<0?-1:1;return t*Z}return e===e?e:0}var z=K,ee=z;function te(e){var t=ee(e),o=t%1;return t===t?o?t-o:t:0}var ne=te,oe=A,re=D,se=ne,ie=Math.ceil,ae=Math.max;function le(e,t,o){(o?re(e,t,o):t===void 0)?t=1:t=ae(se(t),0);var r=e==null?0:e.length;if(!r||t<1)return[];for(var s=0,l=0,i=Array(ie(r/t));s<r;)i[l++]=oe(e,s,s+=t);return i}var ce=le,ue=(e,t)=>{for(const[o,r]of t)e[o]=r;return e};const de={},fe=e=>(N("data-v-39432f99"),e=e(),x(),e),ve={class:"container"},_e=fe(()=>_("div",{class:"spinner"},null,-1)),me=[_e];function ge(e,t){return p(),I("div",ve,me)}var pe=ue(de,[["render",ge],["__scopeId","data-v-39432f99"]]);const he=e=>({loading(){e.value="loading"},loaded(){e.value="loaded"},complete(){e.value="complete"},error(){e.value="error"}});function Ie(e,t){return()=>{t.loading(),e("infinite",t)}}function ye(e,t){var o=e.getBoundingClientRect();return Math.abs(o.top)*2<=t.clientHeight||!t.clientHeight}const be=(e,{state:t,distance:o,emitInfiniteEvent:r,top:s})=>()=>{const{scrollTop:l,scrollHeight:i,clientHeight:f}=e,v=t.value=="loaded"||!t.value;s&&Math.ceil(l)-o<=0&&v&&r(),!s&&Math.ceil(l)+f>=i-o&&v&&r()};let q;const F=e=>{if(e.target&&!document.querySelector(e.target))return console.error("Vue3 infinite loading: target prop should be a valid css selector");const t=document.querySelector(e.target)||document.documentElement,o=document.querySelector(e.target)||window,r=document.getElementById("vue3-infinite-loading");ye(r,t)&&e.firstLoad&&e.emitInfiniteEvent(),q=be(t,e),o.addEventListener("scroll",q)},w=e=>{(document.querySelector(e.target)||window).removeEventListener("scroll",q)},Se={id:"vue3-infinite-loading"},$e={class:"state-error"},Ee={props:{top:{type:Boolean,required:!1},target:{type:[String,Boolean],required:!1},distance:{type:Number,required:!1,default:0},identifier:{required:!1},firstLoad:{type:Boolean,required:!1,default:!0},slots:{type:Object,required:!1}},emits:["infinite"],setup(e,{emit:t}){const o=e,r=S(""),{top:s,target:l,distance:i,firstLoad:f,slots:v}=o,{identifier:h}=O(o),n={state:r,target:l,distance:i,top:s,firstLoad:f,emitInfiniteEvent:Ie(t,he(r))},d=(a,u)=>$(r,c=>{c=="loaded"&&s&&(Promise.resolve().then(()=>{a.scrollTop=a.scrollHeight-u}),u=a.scrollHeight),c=="complete"&&w(n)}),g=()=>$(h,()=>{r.value="",w(n),F(n)});return W(()=>{F(n);let a=document.querySelector(l)||document.documentElement,u=a.scrollHeight;d(a,u),h&&g()}),Y(()=>{w(n)}),(a,u)=>(p(),I("div",Se,[r.value=="loading"?E(a.$slots,"spinner",{key:0},()=>[k(pe)]):y("v-if",!0),r.value=="complete"?E(a.$slots,"complete",{key:1},()=>{var c;return[_("span",null,M(((c=m(v))==null?void 0:c.complete)||"No more results!"),1)]}):y("v-if",!0),r.value=="error"?E(a.$slots,"error",{key:2,retry:n.emitInfiniteEvent},()=>{var c;return[_("span",$e,[_("span",null,M(((c=m(v))==null?void 0:c.error)||"Oops something went wrong!"),1),_("button",{class:"retry",onClick:u[0]||(u[0]=(...b)=>n.emitInfiniteEvent&&n.emitInfiniteEvent(...b))},"retry")])]}):y("v-if",!0)]))}};const ke=e=>(N("data-v-5e596fbc"),e=e(),x(),e),qe={key:0,class:"message-list"},we={id:"message-list-content"},Ce=ke(()=>_("div",{class:"no-messages"}," No more messages to show, this is the beginning of the channel. ",-1)),Me=G({setup(e){const t=T(),o=J(),r=30,s=S(0),l=S([]),i=H(()=>{var n;return(n=t.channels)==null?void 0:n.find(d=>{var g;return d.id===((g=o.params)==null?void 0:g.channelId)})}),f=H(()=>{var n,d;return ce([...(d=(n=i.value)==null?void 0:n.rootMessages)!=null?d:[]].reverse(),r)}),v=n=>{setTimeout(()=>{if(!i.value||!f.value[s.value]){n.loaded();return}const d=[...f.value[s.value]];l.value.unshift(...d.reverse()),s.value++,s.value>=f.value.length?n.complete():n.loaded()},100)},h=n=>n>0?l.value[n-1]:null;return $(i,()=>{l.value=[],s.value=0}),(n,d)=>{var a,u;const g=R;return((a=m(i))==null?void 0:a.id)?(p(),I("div",qe,[k(j,{title:`#${m(i).name}`,subtitle:m(i).topic,"show-menu-button":""},null,8,["title","subtitle"]),_("div",we,[k(m(Ee),{identifier:(u=m(i))==null?void 0:u.id,target:"#message-list-content",top:"","first-load":"",onInfinite:v},{complete:P(()=>[Ce]),_:1},8,["identifier"]),(p(!0),I(Q,null,U(l.value,(c,b)=>(p(),B(g,{key:c.ts,message:c,"above-message":h(b)},null,8,["message","above-message"]))),128))])])):y("",!0)}}});var Ne=C(Me,[["__scopeId","data-v-5e596fbc"]]);const xe={};function He(e,t){const o=Ne;return p(),B(o)}var Fe=C(xe,[["render",He]]);export{Fe as default};
